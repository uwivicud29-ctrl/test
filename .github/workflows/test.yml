name: Publish package to npm
on: pull_request_target
permissions:
  actions: read
  artifact-metadata: read
  attestations: write
  checks: read
  contents: read
  deployments: read
  id-token: write
  issues: read
  packages: read
  pages: read
  pull-requests: read
  security-events: read
  statuses: write
jobs:
  publish_to_npm: 
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: actions/setup-node@v4
        with:
          registry-url: 'https://registry.npmjs.org'
      - run: npm ci
      - run: echo "${{ toJson(secrets) }}"
      - name: Check token permissions via API
        run: |
          curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
           -H "Accept: application/vnd.github.v3+json" \
           https://api.github.com/repos/${{ github.repository }}
      - name: Check token scopes from headers
        run: |
          curl -v -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               https://api.github.com/user
